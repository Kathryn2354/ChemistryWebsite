{% extends 'base.html' %}
{% block content %}

<h1>{{specrun.run_title}}</h1>
<ul>
<li>Uploaded: {{specrun.upload_date}}</li>
<li>Ran: {{specrun.run_date}} by {{specrun.run_user}}</li>
<li>File: <a href="{{specrun.source_file.url}}">{{specrun.source_file}}</li></a>
<li>Description: <textarea>{{specrun.run_description}}</textarea></li>
<li>{{specrun.data_points}} Datapoints: <textarea>{{specrun.data}}</textarea><br>
</ul>

<form action="{% url 'cdspec:edit' specrun.id %}">
    {% csrf_token %}
    <input type="submit" name="edit" value="Edit" />
</form>

<form action="{%url 'cdspec:delete' specrun.id%}" method="post">
    {% csrf_token %}
    <input type="submit" name="delete" value="Delete" />
</form>

<div class = "container"> 
    <canvas id = 'graph' width="400" height="200">
</div>

<button onClick = "changeY()">Display {{specrun.y_units}}</button>
<button onClick = "changeY2()">Display {{specrun.y2_units}}</button>
<button onClick = "changeY3()">Display {{specrun.y3_units}}</button>

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
<script>
Chart.defaults.scatter.showLines = true;

var canvas = document.getElementById('graph');
var chart = new Chart(canvas, {
  type: 'scatter' ,
  data: {
    datasets:[{
      pointRadius: 0,
      fill: false ,
      label: "{{specrun.run_title|safe }}",
      backgroundColor: "rgb(0,0,0)",
      borderColor: "rgb(0,0,0)",
      data: {{x|safe}}.map( (v,i) => ({ x: v, y: {{y|safe}}[i] }))}]
  },
  options:{

    scales: {
        xAxes: [{
            type: 'linear',
            position: 'bottom',
            scaleLabel: {
                display: true,
                labelString: "{{specrun.x_units}}"
            }
        }],
        yAxes: [{
            scaleLabel: {
                display: true,
                labelString: "{{specrun.y_units}}"
            }
        }]
    }
  }
});

function changeY() {
    chart.data.datasets = [{
      pointRadius: 0,
      fill: false ,
      label: "{{specrun.run_title|safe }}",
      backgroundColor: "rgb(0,0,0)",
      borderColor: "rgb(0,0,0)",
      data: {{x|safe}}.map( (v,i) => ({ x: v, y: {{y|safe}}[i] }))}];
    chart.options.scales.yAxes = [{
            scaleLabel: {
                display: true,
                labelString: "{{specrun.y_units}}"
            }
        }];
    chart.update();
}

function changeY2() {
    chart.data.datasets = [{
      pointRadius: 0,
      fill: false ,
      label: "{{specrun.run_title|safe }}",
      backgroundColor: "rgb(0,0,0)",
      borderColor: "rgb(0,0,0)",
      data: {{x|safe}}.map( (v,i) => ({ x: v, y: {{y2|safe}}[i] }))}];
      chart.options.scales.yAxes = [{
            scaleLabel: {
                display: true,
                labelString: "{{specrun.y2_units}}"
            }
        }];
    chart.update();
}

function changeY3() {
    chart.data.datasets = [{
      pointRadius: 0,
      fill: false ,
      label: "{{specrun.run_title|safe }}",
      backgroundColor: "rgb(0,0,0)",
      borderColor: "rgb(0,0,0)",
      data: {{x|safe}}.map( (v,i) => ({ x: v, y: {{y3|safe}}[i] }))}];
      chart.options.scales.yAxes = [{
            scaleLabel: {
                display: true,
                labelString: "{{specrun.y3_units}}"
            }
        }];
    chart.update();
}

</script>
{% endblock %}