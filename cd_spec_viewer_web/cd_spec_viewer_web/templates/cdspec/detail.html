{% extends 'base.html' %}
{% block content %}

<h1>{{specrun.run_title}}</h1>
<ul>
<li>Uploaded: {{specrun.upload_date}}</li>
<li>Ran: {{specrun.run_date}} by {{specrun.run_user}}</li>
<li>File: <a href="{{specrun.source_file.url}}">{{specrun.source_file}}</li></a>
<li>Description: <textarea>{{specrun.run_description}}</textarea></li>
<li>{{specrun.data_points}} Datapoints: <textarea>{{specrun.data}}</textarea><br>
</ul>

<form action="{% url 'cdspec:edit' specrun.id %}">
    {% csrf_token %}
    <input type="submit" name="edit" value="Edit" />
</form>

<form action="{%url 'cdspec:delete' specrun.id%}" method="post">
    {% csrf_token %}
    <input type="submit" name="delete" value="Delete" />
</form>

<div id="graph" width="400" height="200"> </div>

<button onClick = "changeY()">Display {{specrun.y_units}}</button>
<button onClick = "changeY2()">Display {{specrun.y2_units}}</button>
<button onClick = "changeY3()">Display {{specrun.y3_units}}</button>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<link rel="stylesheet" href="https://mdbcdn.b-cdn.net/wp-content/themes/mdbootstrap4/css/mdb5/plugins/color-picker.min.css?v=3.3.0">
<div class="color-picker" data-mdb-picker="color-picker" style="max-width: 350px;">
      <div class="color-picker-canvas-wrapper">
        <div class="color-picker-canvas-dot" style="top: -8px; left: 342px;"></div>
        <canvas width="350" height="350"><div class="color-picker-canvas-dot" style="top: -8px; left: 342px;"></div></canvas>
      </div>
    
      <div class="color-picker-controls d-flex align-items-center p-2">
        <div class="color-picker-color-dot-wrapper">
          <div class="color-picker-color-dot" style="background-color: rgb(255, 0, 0);">
          </div>
        </div>
        <div class="ps-4 w-100">
          <div class="color-picker-range">
            <input type="range" class="form-range" value="0" min="0" max="360" id="hueRange">
          </div>
          <div class="color-picker-range">
            <div class="color-picker-range-alpha">
              <input type="range" class="form-range" value="1" min="0" max="1" step="0.01" id="alphaRange" style="--track-background:linear-gradient(to right, transparent, rgba(255,0,0, 1);">
            </div>
          </div>
        </div>
      </div>
    <div class="color-picker-color-inputs-wrapper d-flex align-items-center p-2">
      <div class="form-outline me-2">
        <input type="number" id="h" class="form-control text-center me-2 active" min="0" max="360" step="1">
        <label class="form-label" for="input-1" style="margin-left: 0px;">h</label>
      <div class="form-notch"><div class="form-notch-leading" style="width: 9px;"></div><div class="form-notch-middle" style="width: 15.2px;"></div><div class="form-notch-trailing"></div></div></div>
      <div class="form-outline me-2">
        <input type="number" id="s" class="form-control text-center me-2 active" min="0" max="1" step="0.01">
        <label class="form-label" for="input-2" style="margin-left: 0px;">s</label>
      <div class="form-notch"><div class="form-notch-leading" style="width: 9px;"></div><div class="form-notch-middle" style="width: 14.4px;"></div><div class="form-notch-trailing"></div></div></div>
      <div class="form-outline me-2">
        <input type="number" id="l" class="form-control text-center me-2 active" min="0" max="1" step="0.01">
        <label class="form-label" for="input-3" style="margin-left: 0px;">l</label>
      <div class="form-notch"><div class="form-notch-leading" style="width: 9px;"></div><div class="form-notch-middle" style="width: 11.2px;"></div><div class="form-notch-trailing"></div></div></div>
      <div class="form-outline">
        <input type="number" id="a" class="form-control text-center me-2 active" min="0" max="1" step="0.01">
        <label class="form-label" for="input-4" style="margin-left: 0px;">a</label>
      <div class="form-notch"><div class="form-notch-leading" style="width: 9px;"></div><div class="form-notch-middle" style="width: 15.2px;"></div><div class="form-notch-trailing"></div></div></div>
    
      <div class="color-picker-change-view-icons d-flex flex-column align-items-center">
        <button id="next-format" type="button" class="btn btn-link btn-sm py-0 px-2">
          <i class="fas fa-angle-up"></i>
        </button>
        <button id="previous-format" type="button" class="btn btn-link btn-sm py-0 px-2">
          <i class="fas fa-angle-down"></i>
        </button>
      </div>
    
      <button id="copy-code" class="btn btn-link py-0 px-2"><i class="far fa-copy"></i></button>
    </div></div>

<script>
var canvas = document.getElementById('graph');
//plot (x, y) data as scatter plot

var trace = {
    x: {{x|safe}},
    y: {{y|safe}},
    mode: 'lines+markers',
    marker: {
        color: 'black'
    },
    line: {
        color: 'black'
    }
};

var data = [trace];

var layout = {
    showlegend: false,
    xaxis: {
        title: {
            text: '{{specrun.x_units}}'
        }
    }, 
    yaxis: {
        title: {
            text: '{{specrun.y_units}}'
        }
    }
}; 

Plotly.newPlot(canvas, data, layout);

//change data/axes to (x, y)
function changeY() {
    Plotly.deleteTraces(canvas, 0);
    Plotly.addTraces(canvas, {
        x: {{x|safe}},
        y: {{y|safe}},
        mode: 'lines+markers',
         marker: {
            color: 'black'
        },
        line: {
            color: 'black' 
        }
    });

    var layout_update = {
        yaxis: {
            title: {
                text: '{{specrun.y_units}}'
            }
        }
    };

    Plotly.update(canvas, {}, layout_update);
}

//change data/axes to (x, y2)
function changeY2() {
    Plotly.deleteTraces(canvas, 0);
    Plotly.addTraces(canvas, {
        x: {{x|safe}},
        y: {{y2|safe}},
        mode: 'lines+markers',
         marker: {
            color: 'black'
        },
        line: {
            color: 'black' 
        }
    });
    var layout_update = {
        yaxis: {
            title: {
                text: '{{specrun.y2_units}}'
            }
        }
    };
    Plotly.update(canvas, {}, layout_update);
}

//change data/axes to (x, y3)
function changeY3() {
    Plotly.deleteTraces(canvas, 0);
    Plotly.addTraces(canvas, {
        x: {{x|safe}},
        y: {{y3|safe}},
        mode: 'lines+markers',
         marker: {
            color: 'black'
        },
        line: {
            color: 'black' 
        }
    });
    var layout_update = {
        yaxis: {
            title: {
                text: '{{specrun.y3_units}}'
            }
        }
    };
    Plotly.update(canvas, {}, layout_update);
}

</script>
{% endblock %}